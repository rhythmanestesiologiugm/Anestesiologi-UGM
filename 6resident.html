<div id="resident-search-widget">
    <style>
        /* Scoped CSS */
        #resident-search-widget {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 20px auto;
            max-width: 800px;
            color: #333;
            box-sizing: border-box;
        }

        #resident-search-widget .rse-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #bdc3c7;
        }

        #resident-search-widget h2 {
            border-bottom: 2px solid #003366;
            padding-bottom: 0.5rem;
            font-size: 1.5rem;
            color: #003366;
            margin-top: 0;
        }

        #resident-search-widget label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        #resident-search-widget textarea {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; 
            text-transform: uppercase;
            resize: vertical;
            min-height: 50px;
            font-family: monospace;
        }

        #resident-search-widget textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        #resident-search-widget .rse-btn {
            margin-top: 0.5rem;
            background-color: #003366;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        #resident-search-widget .rse-btn:hover {
            background-color: #002244;
        }

        /* Result String Box */
        #resident-search-widget .rse-output-box {
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f4f8;
            border: 1px dashed #2980b9;
            border-radius: 4px;
            font-family: monospace;
            color: #2c3e50;
            word-wrap: break-word;
            display: none; /* Hidden by default */
        }

        #resident-search-widget table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            font-size: 0.95rem;
        }

        #resident-search-widget th, 
        #resident-search-widget td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        #resident-search-widget th {
            background-color: #f4f4f4;
            font-weight: 700;
            color: #2c3e50;
        }

        #resident-search-widget .rse-note {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-top: 5px;
        }

        #resident-search-widget .rse-error {
            color: #e74c3c;
            font-weight: bold;
        }
        
        #resident-search-widget .rse-staff {
            color: #2980b9;
            font-weight: bold;
        }
    </style>

    <div class="rse-container">
        <h2>Search Engine (Residen & Staff)</h2>
        <label for="rse-input">Enter Codes (Separated by Space, Enter, or /):</label>
        <textarea id="rse-input" placeholder="Example: RI SIP KEV ABE" rows="2"></textarea>
        
        <p class="rse-note">Database: Stase PPDS (Jan-Jul 2026) & Staff Pengajar.</p>
        <button class="rse-btn" onclick="runResidentSearch()">Search & Sort</button>

        <div id="rse-output-string" class="rse-output-box"></div>

        <table id="rse-result-table" style="display:none;">
            <thead>
                <tr>
                    <th style="width: 10%;">No</th>
                    <th style="width: 15%;">Code</th>
                    <th style="width: 45%;">Full Name</th>
                    <th style="width: 30%;">Level / Status</th>
                </tr>
            </thead>
            <tbody id="rse-table-body">
            </tbody>
        </table>
    </div>

    <script>
        // --- STAFF DATABASE ---
        const STAFF_DB = {
            "RI": "dr. Calcarina Fitriani Retno Wisudarti, Sp. An-TI, Subsp. TI(K)",
            "BW": "Dr. dr. Bhirowo Yudo Pratomo, Sp. An-TI, Subsp. An. Kv(K)",
            "SU": "Dr. dr. Sudadi, Sp. An-TI, Subsp. N.An(K), Subsp. An.R(K)",
            "YW": "Prof. dr. Yunita Widyastuti, M.Kes, Sp. An-TI, Subsp. An. Ped(K), Ph.D",
            "DJ": "Dr. dr. Djayanti Sari, M.Kes, Sp. An-TI, Subsp. An. Ped(K)",
            "JF": "Dr. dr. Akhmad Yun Jufan, M.Sc, Sp. An-TI, Subsp. TI(K)",
            "MUD": "Dr. dr. Mahmud, M.Sc, Sp. An-TI, Subsp. M.N(K)",
            "AYI": "dr. Ratih Kumala Fajar Apsari, M.Sc, Sp. An-TI, Subsp. An.O(K)",
            "FAR": "dr. Farhan Ali Rahman, Sp. An-TI, FIP",
            "YAN": "dr. Yusuf Alim Musthofa A, Sp. An-TI",
            "IHA": "dr. Irham Hanafi, Sp. An-TI",
            "YOG": "dr. M. Yogi Prandar",
            "WIT": "dr. Dhanty Dwita Sari, Sp. An-TI",
            "IRA": "dr. Irada Imaniar, Sp. An-TI",
            "FAL": "dr. Febrian Naufaldi, Sp. An-TI",
            "TAM": "dr. Adijaya Dita Pratama, Sp. An-TI",
            "NIA": "Dr. dr. Juni Kurniawati, M.Sc, Sp. An-TI, Subsp. An. Kv(K)",
            "BOW": "dr. Bowo Adiyanto, M.Sc, Sp. An-TI, Subsp. TI(K)",
            "NIS": "dr. Anisa Fadhila Farid, Sp. An-TI, Subsp. An. Ped(K)",
            "PIN": "dr. Pinter Hartono, MM, Sp. An-TI, Subsp. An. O(K)",
            "RID": "dr. Rifdhani Fakhrudin Nur, Sp. An-TI, Subsp. An. Kv(K)",
            "MET": "dr. Meta Restu Synthana, Sp. An-TI, Subsp. An. Kv(K)",
            "SAM": "dr. Erlangga Prasmaya, Sp. An-TI, Subsp. TI(K)",
            "DAI": "dr. Arif Ikhwandi, Sp. An-TI, Subsp. An.O(K)",
            "GIL": "dr. Raden Gilar Rizki Aji Pradana, Sp.An-TI"
        };

        // --- RESIDENT DATABASE ---
        const RESIDENT_DB = {
            // POST CHIEF (Previous + Promoted)
            "TIR": { name: "Hening Tirta Kusumawardani", level: "POST CHIEF" },
            "ALI": { name: "Aliannor", level: "POST CHIEF" },
            "FAW": { name: "Anggita Fatwa", level: "POST CHIEF" },
            "ASH": { name: "Diena Ashlihati", level: "POST CHIEF" },
            "AIL": { name: "Ismail Hasan", level: "POST CHIEF" },
            "JAT": { name: "Sudjati Adhinugroho", level: "POST CHIEF" },
            "TIK": { name: "Atika Rachmi", level: "POST CHIEF" },
            "EBY": { name: "Deby Aulia Rahmi", level: "POST CHIEF" },
            "UZI": { name: "Fauzi Agung Nugroho", level: "POST CHIEF" },
            "QIH": { name: "Muhammad Fiqih Hidayat", level: "POST CHIEF" },
            "SIR": { name: "Nashiruddin", level: "POST CHIEF" },
            "NUS": { name: "Stefanus Danan Nugroho", level: "POST CHIEF" },
            "TEP": { name: "Stephanie Sutrisno", level: "POST CHIEF" },
            "ILY": { name: "Willy Irawan", level: "POST CHIEF" },
            "ZUL": { name: "Zulqaidandy Rahman", level: "POST CHIEF" },
            "MII": { name: "Fatmi Eka Putri", level: "POST CHIEF" },
            "ARE": { name: "Arliestianto Noor Eka Putra", level: "POST CHIEF" },
            "YUV": { name: "Ayuvy Monzalitza", level: "POST CHIEF" },
            "SIA": { name: "Christine Tirza Thresia Jitmau", level: "POST CHIEF" },
            "EMA": { name: "Emanuel Yan Daniel Prabowo", level: "POST CHIEF" },
            "SEN": { name: "Ezra Senna Pradesya", level: "POST CHIEF" },
            "REV": { name: "Irvan Revaldi Loho", level: "POST CHIEF" },
            "MAD": { name: "Muhammad Syarif Nurdianto", level: "POST CHIEF" },
            "NOU": { name: "Noufal Riandi Khairul", level: "POST CHIEF" },
            "LIT": { name: "Talitha Azalia", level: "POST CHIEF" },
            "KIR": { name: "Yusuf Kirana Raksawardana", level: "POST CHIEF" },
            // CHIEF (New)
            "SWA": { name: "Raden Sureswara Agrawijaya", level: "CHIEF" },
            "DHI": { name: "Dhita Budi Wibowo", level: "CHIEF" },
            "KEN": { name: "Iken Agustina", level: "CHIEF" },
            "LUS": { name: "Tulus Sihotang", level: "CHIEF" },
            "MAW": { name: "Jaka Hermawan", level: "CHIEF" },
            "THA": { name: "Nathanael Jaya Bimastani", level: "CHIEF" },
            // R7
            "FIZ": { name: "Al Hafiz Aidil Pakpahan", level: "R7 (III C)" },
            "NAT": { name: "Anggara Aprinata Widyawan", level: "R7 (III C)" },
            "AAF": { name: "Ari Afandi", level: "R7 (III C)" },
            "ULA": { name: "Arvy Maula Maryani", level: "R7 (III C)" },
            "DIM": { name: "Dimaz Prabu Ginanjar Setiadi", level: "R7 (III C)" },
            "IAH": { name: "Indah Novianty", level: "R7 (III C)" },
            "ENA": { name: "Radyan Pramono Sri Rena Kusdiyono", level: "R7 (III C)" },
            "UTH": { name: "Ruth Devi Numberi", level: "R7 (III C)" },
            "MON": { name: "Ruth Monica Br Mangunsong", level: "R7 (III C)" },
            "FIA": { name: "Sofia Zachra Faiza", level: "R7 (III C)" },
            "TUT": { name: "Sri Wydiastuti", level: "R7 (III C)" },
            "PRA": { name: "Tito Novrian Pratama", level: "R7 (III C)" },
            "ZAC": { name: "Zacky Aulia Mursi", level: "R7 (III C)" },
            // R6
            "END": { name: "Hendrian Ade Hardianto", level: "R6 (III B)" },
            "VIN": { name: "Alvina Carolina BS", level: "R6 (III B)" },
            "ATI": { name: "Atika Putri Pertiwi", level: "R6 (III B)" },
            "ISS": { name: "Danissa Fidia Puteri", level: "R6 (III B)" },
            "GHE": { name: "Ghenta Ajuskri Pratama", level: "R6 (III B)" },
            "HAF": { name: "Hafidh Awwal", level: "R6 (III B)" },
            "IIN": { name: "Iin Suryanti", level: "R6 (III B)" },
            "FIT": { name: "Khozatin Zuni Fitmawati", level: "R6 (III B)" },
            "IZY": { name: "Muhammad Rizky Sofyan", level: "R6 (III B)" },
            "NUP": { name: "Nurprianto", level: "R6 (III B)" },
            "ABO": { name: "Prayogo Budhi Prabowo", level: "R6 (III B)" },
            "RAD": { name: "Rahmad Dui Wahyudi", level: "R6 (III B)" },
            "RON": { name: "Ronaldo", level: "R6 (III B)" },
            "RUD": { name: "Rudi Ardian Saputra", level: "R6 (III B)" },
            "AUL": { name: "Sanggiani Diah Aulia", level: "R6 (III B)" },
            "STA": { name: "Shianita Stanie", level: "R6 (III B)" },
            // R5
            "ELA": { name: "Apsopela Sandivera", level: "R5 (III A)" },
            "ARO": { name: "Ario Sagaskara Kumudhajati", level: "R5 (III A)" },
            "AUM": { name: "Arum Pamungkas", level: "R5 (III A)" },
            "RAS": { name: "Mochammad Rasyiid Ash Shiddieqy", level: "R5 (III A)" },
            "ZUH": { name: "Mochammad Zuhrul Balad Rosadi", level: "R5 (III A)" },
            "IBA": { name: "Muhammad Iqbal Mahfud", level: "R5 (III A)" },
            "RYA": { name: "Muhammad Ryan Radifan Gustisiya", level: "R5 (III A)" },
            "OKA": { name: "Okky Alfian Fatchrojiono", level: "R5 (III A)" },
            "PMA": { name: "Primadhy Rahardian Wijaya", level: "R5 (III A)" },
            "HAD": { name: "Rahadian Arista Dhata", level: "R5 (III A)" },
            "RAK": { name: "Raky Nara Swari", level: "R5 (III A)" },
            "RAT": { name: "Ratna Sari Pratiwi", level: "R5 (III A)" },
            "RAR": { name: "Rini Maysarah Bantilan", level: "R5 (III A)" },
            "INO": { name: "Sutrisno", level: "R5 (III A)" },
            "ZKI": { name: "Zaki Dewantoro", level: "R5 (III A)" },
            "ODI": { name: "Sondi Valentinus Lumban Batu", level: "R5 (III A)" },
            "UPA": { name: "Ulfah S. Madamar", level: "R5 (III A)" },
            "YUS": { name: "Yusuf Rumbiak", level: "R5 (III A)" },
            // R4
            "ABE": { name: "Abetius Wenda", level: "R4 (II B)" },
            "GUS": { name: "Agus Eko Radittyanto", level: "R4 (II B)" },
            "TOS": { name: "Dedy Santoso", level: "R4 (II B)" },
            "PAS": { name: "Dwi Prasetyo Nugroho", level: "R4 (II B)" },
            "BEL": { name: "Dwina Agrila Lakabela", level: "R4 (II B)" },
            "DUL": { name: "Fahmy Abdul Haq", level: "R4 (II B)" },
            "SIP": { name: "Helni Sipayung", level: "R4 (II B)" },
            "JIF": { name: "Jifani Rasyad", level: "R4 (II B)" },
            "KAL": { name: "Kalam Majid Biruni", level: "R4 (II B)" },
            "BAR": { name: "M. Silahul Jabbar As Siddiq", level: "R4 (II B)" },
            "SID": { name: "M. Shiddiq Dwisurya", level: "R4 (II B)" },
            "EGY": { name: "Peggy Rahmat Syahputra", level: "R4 (II B)" },
            "PUR": { name: "Purbo Prawiro Budiharjo", level: "R4 (II B)" },
            "TOM": { name: "Tomy Resky Sandriya", level: "R4 (II B)" },
            "IJI": { name: "Wiji Hastuti", level: "R4 (II B)" },
            // R3
            "HBS": { name: "Hasbi Bagas Wasisto", level: "R3 (II A)" },
            "HRY": { name: "Harry Salomo", level: "R3 (II A)" },
            "HNA": { name: "Hananya Dwi Anggi Manurung", level: "R3 (II A)" },
            "AJI": { name: "R. Suseno Aji", level: "R3 (II A)" },
            "VNI": { name: "Vania Valentina", level: "R3 (II A)" },
            "HAS": { name: "Ihsan Hamdani", level: "R3 (II A)" },
            "FUZ": { name: "Ahmad Fauzi", level: "R3 (II A)" },
            "DST": { name: "Adisty Chandra", level: "R3 (II A)" },
            "RAF": { name: "Siti Arafah Nasrullah", level: "R3 (II A)" },
            "KEV": { name: "Kevin Darmawan", level: "R3 (II A)" },
            "AGM": { name: "Agam Meureza Prabowo", level: "R3 (II A)" },
            "KIN": { name: "MHD Rizky Nanda", level: "R3 (II A)" },
            "NDO": { name: "Nando Rosiarto Aswin", level: "R3 (II A)" },
            "RND": { name: "Rendy Kurniawan", level: "R3 (II A)" },
            "AFD": { name: "Muhammad Afid Fitrah", level: "R3 (II A)" },
            // R2
            "JAN": { name: "Jihan Febrianto", level: "R2 (I B)" },
            "AGG": { name: "Aditya Bagas Caswita", level: "R2 (I B)" },
            "DRE": { name: "Andre Krislee", level: "R2 (I B)" },
            "LIA": { name: "Aulia Zuhria Rahma", level: "R2 (I B)" },
            "DNE": { name: "Daniel Aprianto Sihotang", level: "R2 (I B)" },
            "ION": { name: "Dionisia Setya Putri", level: "R2 (I B)" },
            "FEB": { name: "Febri Anriyani", level: "R2 (I B)" },
            "PTU": { name: "I Putu Bagus Hermawan", level: "R2 (I B)" },
            "INI": { name: "Isni Mellasari", level: "R2 (I B)" },
            "MAH": { name: "Mahyati Sari Zulfa", level: "R2 (I B)" },
            "RZK": { name: "Muhammad Rizki Febrianto", level: "R2 (I B)" },
            "MUS": { name: "Mustika Rizky Putri Nathasya", level: "R2 (I B)" },
            "RZN": { name: "Rizkan Triatmaja", level: "R2 (I B)" },
            "WHU": { name: "Wahyu Cipto Utomo", level: "R2 (I B)" },
            "IRF": { name: "Irfan Ramadhannoor", level: "R2 (I B)" },
            // R1
            "ZOM": { name: "Adzomi Riski Wardana", level: "R1 (I A)" },
            "KIY": { name: "Ahmad Rizki Gusriadi", level: "R1 (I A)" },
            "NDI": { name: "Andi Bagus Pribadi", level: "R1 (I A)" },
            "BER": { name: "Berzelius Febri", level: "R1 (I A)" },
            "FES": { name: "Felix Erlangga Suyatno", level: "R1 (I A)" },
            "HIL": { name: "Hilmy Atha Sitepu", level: "R1 (I A)" },
            "JER": { name: "Josi Jeremia Manurung", level: "R1 (I A)" },
            "RAL": { name: "Rio Geraldy", level: "R1 (I A)" },
            "IVO": { name: "Rivo Junieta Alicia", level: "R1 (I A)" },
            "RUL": { name: "Rully Syahrizal Akhmad", level: "R1 (I A)" },
            "TUN": { name: "Sayyidatunnisa Rizqi", level: "R1 (I A)" },
            "SIG": { name: "Sigma Pomallia", level: "R1 (I A)" },
            "SAB": { name: "Simon Abelardus Bidaya", level: "R1 (I A)" },
            "TAU": { name: "Taufiqurrohman", level: "R1 (I A)" },
            "CEL": { name: "Winetta Celia Fairuza", level: "R1 (I A)" }
        };

        // --- HIERARCHY RANKING (Lower number = Higher Rank) ---
        const RANK_ORDER = {
            "STAFF PENGAJAR": 0,
            "POST CHIEF": 1,
            "CHIEF": 2,
            "R7 (III C)": 3,
            "R6 (III B)": 4,
            "R5 (III A)": 5,
            "R4 (II B)": 6,
            "R3 (II A)": 7,
            "R2 (I B)": 8,
            "R1 (I A)": 9,
            "UNKNOWN": 99
        };

        function runResidentSearch() {
            const input = document.getElementById('rse-input').value;
            const tableBody = document.getElementById('rse-table-body');
            const resultTable = document.getElementById('rse-result-table');
            const outputStringBox = document.getElementById('rse-output-string');
            
            // Clear previous results
            tableBody.innerHTML = '';
            outputStringBox.style.display = 'none';
            outputStringBox.textContent = '';
            
            if (!input.trim()) {
                alert("Please enter at least one code.");
                return;
            }

            // --- 1. Process input: Split by '/', Space, Enter, or Comma ---
            // Regex /[\/\s\n,]+/ matches forward slash, any whitespace (incl newline), or comma
            const codes = input.split(/[\/\s\n,]+/)
                .map(code => code.trim().toUpperCase())
                .filter(code => code.length > 0)
                .slice(0, 50); // Increased limit slightly in case of copy-paste

            if (codes.length === 0) return;

            // --- 2. Map codes to data objects including Rank ---
            const processedData = codes.map(code => {
                let name, level, rank, styleClass;
                const resData = RESIDENT_DB[code];
                const staffData = STAFF_DB[code];

                if (resData) {
                    name = resData.name;
                    level = resData.level;
                    rank = RANK_ORDER[level] !== undefined ? RANK_ORDER[level] : 99;
                    styleClass = "";
                } else if (staffData) {
                    name = staffData;
                    level = "STAFF PENGAJAR";
                    rank = RANK_ORDER["STAFF PENGAJAR"];
                    styleClass = "rse-staff";
                } else {
                    name = "NOT FOUND";
                    level = "-";
                    rank = RANK_ORDER["UNKNOWN"];
                    styleClass = "rse-error";
                }

                return { code, name, level, rank, styleClass };
            });

            // --- 3. GENERATE OUTPUT STRING (Lowest to Highest Rank) ---
            // Filter out errors, then sort DESCENDING by Rank Number (9 -> 0) 
            // because 9 is Lowest Rank (R1) and 0 is Highest Rank (Staff)
            const sortedForString = [...processedData]
                .filter(d => d.rank !== 99) // Exclude unknown
                .sort((a, b) => b.rank - a.rank); 
            
            if (sortedForString.length > 0) {
                const resultCodeString = sortedForString.map(d => d.code).join('/');
                outputStringBox.textContent = "Low-High Rank Order: " + resultCodeString;
                outputStringBox.style.display = "block";
            }

            // --- 4. RENDER TABLE (Highest to Lowest Rank - Standard View) ---
            // Sort Ascending (0 -> 9)
            processedData.sort((a, b) => a.rank - b.rank);

            processedData.forEach((data, index) => {
                const row = document.createElement('tr');

                const cellNo = document.createElement('td');
                cellNo.textContent = index + 1;
                
                const cellCode = document.createElement('td');
                cellCode.textContent = data.code;

                const cellName = document.createElement('td');
                cellName.textContent = data.name;
                if(data.styleClass === "rse-error") cellName.className = "rse-error";

                const cellLevel = document.createElement('td');
                cellLevel.textContent = data.level;
                if(data.styleClass === "rse-staff") cellLevel.className = "rse-staff";

                row.appendChild(cellNo);
                row.appendChild(cellCode);
                row.appendChild(cellName);
                row.appendChild(cellLevel);
                tableBody.appendChild(row);
            });

            // Show table
            resultTable.style.display = "table";
        }
    </script>
</div>

