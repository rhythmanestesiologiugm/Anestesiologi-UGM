<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Clinical Scoring</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --bg: #f4f6f8;
            --border: #ddd;
            
            /* Status Colors */
            --green-bg: #d4edda; --green-txt: #155724; --green-bd: #c3e6cb;
            --yellow-bg: #fff3cd; --yellow-txt: #856404; --yellow-bd: #ffeeba;
            --red-bg: #f8d7da; --red-txt: #721c24; --red-bd: #f5c6cb;
            --blue-bg: #cce5ff; --blue-txt: #004085; --blue-bd: #b8daff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 10px;
            color: #333;
            font-size: 14px;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        /* Collapsible Styling */
        details {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        summary {
            background: var(--secondary);
            color: white;
            padding: 12px 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: none;
        }
        
        summary::-webkit-details-marker { display: none; }
        summary:after { content: '+'; font-size: 16px; }
        details[open] summary:after { content: '-'; }

        .content { padding: 15px; }

        /* Input Sections */
        .param-group {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .param-group:last-child { border-bottom: none; }

        .label {
            display: block;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .sub-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
        }

        /* Grid Buttons */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 5px;
        }

        .btn {
            background: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 4px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 45px;
        }

        .btn strong { display: block; font-size: 0.95rem; margin-bottom: 2px; }
        .btn small { font-size: 0.75rem; color: #666; line-height: 1.1; }

        /* Selected States */
        .btn.selected {
            transform: scale(0.98);
            box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
            font-weight: bold;
        }

        /* * STANDARD LOGIC (EWS, SOFA): 
         * 0 = Green, 1-2 = Yellow, 3+ = Red 
         */
        .btn[data-val="0"].selected { background: var(--green-bg); color: var(--green-txt); border-color: var(--green-bd); }
        .btn[data-val="0"].selected small { color: var(--green-txt); }

        .btn[data-val="1"].selected, .btn[data-val="2"].selected { 
            background: var(--yellow-bg); color: var(--yellow-txt); border-color: var(--yellow-bd); 
        }
        .btn[data-val="1"].selected small, .btn[data-val="2"].selected small { color: var(--yellow-txt); }

        .btn[data-val="3"].selected, .btn[data-val="4"].selected { 
            background: var(--red-bg); color: var(--red-txt); border-color: var(--red-bd); 
        }
        .btn[data-val="3"].selected small, .btn[data-val="4"].selected small { color: var(--red-txt); }

        .btn.blue.selected {
            background: var(--blue-bg); color: var(--blue-txt); border-color: var(--blue-bd);
        }
        .btn.blue.selected small { color: var(--blue-txt); }

        /* * REVERSE LOGIC (PADSS, Aldrete): 
         * 2 = Green (Best), 1 = Yellow, 0 = Red (Worst) 
         */
        .score-high-good .btn[data-val="2"].selected { background: var(--green-bg); color: var(--green-txt); border-color: var(--green-bd); }
        .score-high-good .btn[data-val="1"].selected { background: var(--yellow-bg); color: var(--yellow-txt); border-color: var(--yellow-bd); }
        .score-high-good .btn[data-val="0"].selected { background: var(--red-bg); color: var(--red-txt); border-color: var(--red-bd); }

        /* Inline Result Box */
        .result-box {
            margin-top: 15px;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            background: #eee;
            border: 1px solid #ccc;
            display: block; 
        }
        
        .res-normal { background: var(--green-bg); color: var(--green-txt); border-color: var(--green-bd); }
        .res-warn { background: var(--yellow-bg); color: var(--yellow-txt); border-color: var(--yellow-bd); }
        .res-danger { background: var(--red-bg); color: var(--red-txt); border-color: var(--red-bd); }
        .res-blue { background: var(--blue-bg); color: var(--blue-txt); border-color: var(--blue-bd); }

        .mortality-table {
            width: 100%;
            font-size: 0.85rem;
            margin-top: 8px;
            border-collapse: collapse;
        }
        .mortality-table td { padding: 2px 4px; border-bottom: 1px dashed rgba(0,0,0,0.1); text-align: left; }
        .mortality-table td:last-child { text-align: right; font-weight: bold; }

        /* Number Inputs */
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px; /* Prevent zoom on mobile */
            box-sizing: border-box;
        }

    </style>
</head>
<body>

<h1>Medical Scoring Systems</h1>

<details id="det-ews-d">
    <summary>EWS Dewasa</summary>
    <div class="content">
        <div class="param-group"><span class="label">Henti Jantung?</span><div class="grid"><div class="btn selected" onclick="upd('ews_d','arrest',0,this)"><strong>Tidak</strong></div><div class="btn blue" onclick="upd('ews_d','arrest',1,this)"><strong>Ya</strong></div></div></div>
        <div class="param-group"><span class="label">Kesadaran (AVPU)</span><div class="grid"><div class="btn selected" data-val="0" onclick="upd('ews_d','avpu',0,this)"><strong>A</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','avpu',3,this)"><strong>V/P</strong></div><div class="btn blue" onclick="upd('ews_d','avpu',99,this)"><strong>U</strong></div></div></div>
        <div class="param-group"><span class="label">Tekanan Darah Sistolik</span><div class="grid"><div class="btn blue" onclick="upd('ews_d','bp',99,this)"><strong>&lt;70</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','bp',3,this)"><strong>71-90</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','bp',2,this)"><strong>91-100</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','bp',1,this)"><strong>101-110</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_d','bp',0,this)"><strong>111-219</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','bp',3,this)"><strong>&ge;220</strong></div></div></div>
        <div class="param-group"><span class="label">Nadi (bpm)</span><div class="grid"><div class="btn blue" onclick="upd('ews_d','hr',99,this)"><strong>&le;40 / &ge;140</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','hr',1,this)"><strong>41-50</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_d','hr',0,this)"><strong>51-90</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','hr',1,this)"><strong>91-110</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','hr',2,this)"><strong>111-130</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','hr',3,this)"><strong>131-140</strong></div></div></div>
        <div class="param-group"><span class="label">Respirasi (x/m)</span><div class="grid"><div class="btn blue" onclick="upd('ews_d','rr',99,this)"><strong>&le;5 / &ge;35</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','rr',3,this)"><strong>6-8</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','rr',1,this)"><strong>9-11</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_d','rr',0,this)"><strong>12-20</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','rr',2,this)"><strong>21-24</strong></div><div class="btn" data-val="3" onclick="upd('ews_d','rr',3,this)"><strong>25-34</strong></div></div></div>
        <div class="param-group"><span class="label">Suhu (°C)</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_d','temp',3,this)"><strong>&le;35</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','temp',1,this)"><strong>35.1-36</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_d','temp',0,this)"><strong>36.1-38</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','temp',1,this)"><strong>38.1-39</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','temp',2,this)"><strong>&ge;39.1</strong></div></div></div>
        <div class="param-group"><span class="label">SpO2 (%)</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_d','sat',3,this)"><strong>&le;91</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','sat',2,this)"><strong>92-93</strong></div><div class="btn" data-val="1" onclick="upd('ews_d','sat',1,this)"><strong>94-95</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_d','sat',0,this)"><strong>&ge;96</strong></div></div></div>
        <div class="param-group"><span class="label">Suplemen O2</span><div class="grid"><div class="btn selected" data-val="0" onclick="upd('ews_d','o2',0,this)"><strong>Tidak</strong></div><div class="btn" data-val="2" onclick="upd('ews_d','o2',2,this)"><strong>Ya</strong></div></div></div>
        
        <div id="res-ews_d" class="result-box">Score: 0</div>
    </div>
</details>

<details id="det-ews-p">
    <summary>EWS Pediatrik (PEWS)</summary>
    <div class="content">
        <div class="param-group"><span class="label">Henti Jantung</span><div class="grid"><div class="btn selected" onclick="upd('ews_p','arrest',0,this)"><strong>Tidak</strong></div><div class="btn blue" onclick="upd('ews_p','arrest',1,this)"><strong>Ya</strong></div></div></div>
        
        <div class="param-group"><span class="label">Perilaku (Behavior)</span><div class="grid">
            <div class="btn selected" data-val="0" onclick="upd('ews_p','beh',0,this)"><strong>Biasa</strong><small>Main/sesuai</small></div>
            <div class="btn" data-val="1" onclick="upd('ews_p','beh',1,this)"><strong>Tidur</strong><small>Bisa bangun</small></div>
            <div class="btn" data-val="2" onclick="upd('ews_p','beh',2,this)"><strong>Iritabel</strong><small>Gelisah</small></div>
            <div class="btn" data-val="3" onclick="upd('ews_p','beh',3,this)"><strong>Letargi</strong><small>Penurunan respon</small></div>
        </div></div>

        <div class="param-group"><span class="label">Kardiovaskular</span><div class="grid">
            <div class="btn selected" data-val="0" onclick="upd('ews_p','cv',0,this)"><strong>Normal</strong><small>Pink, CRT&lt;2</small></div>
            <div class="btn" data-val="1" onclick="upd('ews_p','cv',1,this)"><strong>Pucat</strong><small>CRT 2s</small></div>
            <div class="btn" data-val="2" onclick="upd('ews_p','cv',2,this)"><strong>Sianosis</strong><small>CRT&gt;2, Taki</small></div>
            <div class="btn" data-val="3" onclick="upd('ews_p','cv',3,this)"><strong>Mottled</strong><small>CRT&gt;5, Bradi</small></div>
        </div></div>

        <div class="param-group"><span class="label">Respirasi</span><div class="grid">
            <div class="btn selected" data-val="0" onclick="upd('ews_p','resp',0,this)"><strong>Normal</strong><small>No Retract</small></div>
            <div class="btn" data-val="1" onclick="upd('ews_p','resp',1,this)"><strong>Ringan</strong><small>&gt;10RR, FiO2 30</small></div>
            <div class="btn" data-val="2" onclick="upd('ews_p','resp',2,this)"><strong>Sedang</strong><small>&gt;20RR, FiO2 40</small></div>
            <div class="btn" data-val="3" onclick="upd('ews_p','resp',3,this)"><strong>Berat</strong><small>Grunting, FiO2 50</small></div>
        </div></div>
        <div id="res-ews_p" class="result-box">PEWS: 0</div>
    </div>
</details>

<details id="det-ews-o">
    <summary>EWS Obstetri (MEWS)</summary>
    <div class="content">
        <div class="param-group"><span class="label">Henti Jantung</span><div class="grid"><div class="btn selected" onclick="upd('ews_o','arrest',0,this)"><strong>Tidak</strong></div><div class="btn blue" onclick="upd('ews_o','arrest',1,this)"><strong>Ya</strong></div></div></div>
        <div class="param-group"><span class="label">RR (x/m)</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_o','rr',3,this)"><strong>&lt;12</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_o','rr',0,this)"><strong>12-20</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','rr',2,this)"><strong>21-25</strong></div><div class="btn" data-val="3" onclick="upd('ews_o','rr',3,this)"><strong>&gt;25</strong></div></div></div>
        <div class="param-group"><span class="label">SpO2</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_o','sat',3,this)"><strong>&lt;92</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','sat',2,this)"><strong>92-95</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_o','sat',0,this)"><strong>&gt;95</strong></div></div></div>
        <div class="param-group"><span class="label">Suhu</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_o','temp',3,this)"><strong>&lt;36</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_o','temp',0,this)"><strong>36.1-37.2</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','temp',2,this)"><strong>37.3-37.7</strong></div><div class="btn" data-val="3" onclick="upd('ews_o','temp',3,this)"><strong>&gt;37.7</strong></div></div></div>
        <div class="param-group"><span class="label">Sistolik</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_o','sys',3,this)"><strong>&lt;90</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_o','sys',0,this)"><strong>90-140</strong></div><div class="btn" data-val="1" onclick="upd('ews_o','sys',1,this)"><strong>141-150</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','sys',2,this)"><strong>151-160</strong></div><div class="btn" data-val="3" onclick="upd('ews_o','sys',3,this)"><strong>&gt;160</strong></div></div></div>
        <div class="param-group"><span class="label">Diastolik</span><div class="grid"><div class="btn selected" data-val="0" onclick="upd('ews_o','dia',0,this)"><strong>60-90</strong></div><div class="btn" data-val="1" onclick="upd('ews_o','dia',1,this)"><strong>91-100</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','dia',2,this)"><strong>101-110</strong></div><div class="btn" data-val="3" onclick="upd('ews_o','dia',3,this)"><strong>&gt;110</strong></div></div></div>
        <div class="param-group"><span class="label">Nadi</span><div class="grid"><div class="btn" data-val="3" onclick="upd('ews_o','hr',3,this)"><strong>&lt;50</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','hr',2,this)"><strong>50-60</strong></div><div class="btn selected" data-val="0" onclick="upd('ews_o','hr',0,this)"><strong>61-100</strong></div><div class="btn" data-val="1" onclick="upd('ews_o','hr',1,this)"><strong>101-110</strong></div><div class="btn" data-val="2" onclick="upd('ews_o','hr',2,this)"><strong>111-120</strong></div><div class="btn" data-val="3" onclick="upd('ews_o','hr',3,this)"><strong>&gt;120</strong></div></div></div>
        <div class="param-group"><span class="label">Other (Red Flags)</span><div class="grid">
            <div class="btn selected" data-val="0" onclick="upd('ews_o','avpu',0,this)"><strong>Alert</strong></div>
            <div class="btn" data-val="3" onclick="upd('ews_o','avpu',3,this)"><strong>Not Alert</strong></div>
            <div class="btn selected" data-val="0" onclick="upd('ews_o','pain',0,this)"><strong>No Pain</strong></div>
            <div class="btn" data-val="3" onclick="upd('ews_o','pain',3,this)"><strong>Pain++</strong></div>
            <div class="btn selected" data-val="0" onclick="upd('ews_o','lochia',0,this)"><strong>Normal</strong></div>
            <div class="btn" data-val="3" onclick="upd('ews_o','lochia',3,this)"><strong>Lochia++</strong></div>
            <div class="btn selected" data-val="0" onclick="upd('ews_o','prot',0,this)"><strong>Normal</strong></div>
            <div class="btn" data-val="3" onclick="upd('ews_o','prot',3,this)"><strong>Prot >++</strong></div>
        </div></div>
        <div id="res-ews_o" class="result-box">MEWS: 0</div>
    </div>
</details>

<details id="det-sofa">
    <summary>SOFA Score</summary>
    <div class="content">
        <div class="param-group">
            <span class="label">Respiration (PaO2/FiO2 mmHg)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','resp',0,this)"><strong>&ge;400</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','resp',1,this)"><strong>300-399</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','resp',2,this)"><strong>200-299</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','resp',2,this)"><strong>&le;199</strong><small>No Vent</small></div>
                <div class="btn" data-val="3" onclick="upd('sofa','resp',3,this)"><strong>100-199</strong><small>Ventilated</small></div>
                <div class="btn" data-val="4" onclick="upd('sofa','resp',4,this)"><strong>&lt;100</strong><small>Ventilated</small></div>
            </div>
        </div>
        <div class="param-group">
            <span class="label">Coagulation (Platelets x10³)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','coag',0,this)"><strong>&ge;150</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','coag',1,this)"><strong>100-149</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','coag',2,this)"><strong>50-99</strong></div>
                <div class="btn" data-val="3" onclick="upd('sofa','coag',3,this)"><strong>20-49</strong></div>
                <div class="btn" data-val="4" onclick="upd('sofa','coag',4,this)"><strong>&lt;20</strong></div>
            </div>
        </div>
        <div class="param-group">
            <span class="label">Liver (Bilirubin mg/dL)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','liv',0,this)"><strong>&lt;1.2</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','liv',1,this)"><strong>1.2-1.9</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','liv',2,this)"><strong>2.0-5.9</strong></div>
                <div class="btn" data-val="3" onclick="upd('sofa','liv',3,this)"><strong>6.0-11.9</strong></div>
                <div class="btn" data-val="4" onclick="upd('sofa','liv',4,this)"><strong>&ge;12.0</strong></div>
            </div>
        </div>
        <div class="param-group">
            <span class="label">Cardiovascular (Hypotension)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','cv',0,this)"><strong>None</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','cv',1,this)"><strong>MAP &lt;70</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','cv',2,this)"><strong>Dop &le;5</strong><small>or Dobut</small></div>
                <div class="btn" data-val="3" onclick="upd('sofa','cv',3,this)"><strong>NE &le;0.1</strong><small>or Epi &le;0.1</small></div>
                <div class="btn" data-val="4" onclick="upd('sofa','cv',4,this)"><strong>NE &gt;0.1</strong><small>or Epi &gt;0.1</small></div>
            </div>
        </div>
        <div class="param-group">
            <span class="label">Neurologic (GCS)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','cns',0,this)"><strong>15</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','cns',1,this)"><strong>13-14</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','cns',2,this)"><strong>10-12</strong></div>
                <div class="btn" data-val="3" onclick="upd('sofa','cns',3,this)"><strong>6-9</strong></div>
                <div class="btn" data-val="4" onclick="upd('sofa','cns',4,this)"><strong>&lt;6</strong></div>
            </div>
        </div>
        <div class="param-group">
            <span class="label">Renal (Creatinine mg/dL or UOP)</span>
            <div class="grid">
                <div class="btn selected" data-val="0" onclick="upd('sofa','ren',0,this)"><strong>&lt;1.2</strong></div>
                <div class="btn" data-val="1" onclick="upd('sofa','ren',1,this)"><strong>1.2-1.9</strong></div>
                <div class="btn" data-val="2" onclick="upd('sofa','ren',2,this)"><strong>2.0-3.4</strong></div>
                <div class="btn" data-val="3" onclick="upd('sofa','ren',3,this)"><strong>3.5-4.9</strong><small>or &lt;500ml</small></div>
                <div class="btn" data-val="4" onclick="upd('sofa','ren',4,this)"><strong>&ge;5.0</strong><small>or &lt;200ml</small></div>
            </div>
        </div>

        <div id="res-sofa" class="result-box">Total SOFA: 0</div>
    </div>
</details>

<details id="det-rsbi">
    <summary>RSBI (Weaning)</summary>
    <div class="content">
        <div class="param-group">
            <span class="label">Respiratory Rate (breaths/min)</span>
            <input type="number" id="rsbi-rr" placeholder="e.g. 20" oninput="calcRSBI()">
        </div>
        <div class="param-group">
            <span class="label">Tidal Volume (mL)</span>
            <input type="number" id="rsbi-tv" placeholder="e.g. 400" oninput="calcRSBI()">
        </div>
        <div id="res-rsbi" class="result-box">Waiting for input...</div>
    </div>
</details>

<details id="det-rass">
    <summary>RASS (Sedation)</summary>
    <div class="content">
        <div class="grid" style="grid-template-columns: 1fr;">
            <div class="btn" data-val="3" onclick="upd('rass','val',4,this)"><strong>+4 Combative</strong><small>Violent, danger to staff</small></div>
            <div class="btn" data-val="2" onclick="upd('rass','val',3,this)"><strong>+3 Very Agitated</strong><small>Pulls tubes, aggressive</small></div>
            <div class="btn" data-val="2" onclick="upd('rass','val',2,this)"><strong>+2 Agitated</strong><small>Frequent non-purposeful movement</small></div>
            <div class="btn" data-val="1" onclick="upd('rass','val',1,this)"><strong>+1 Restless</strong><small>Anxious but not aggressive</small></div>
            <div class="btn selected" data-val="0" onclick="upd('rass','val',0,this)"><strong>0 Alert & Calm</strong></div>
            <div class="btn" data-val="1" onclick="upd('rass','val',-1,this)"><strong>-1 Drowsy</strong><small>Awakens to voice (>10s)</small></div>
            <div class="btn" data-val="2" onclick="upd('rass','val',-2,this)"><strong>-2 Light Sedation</strong><small>Brief awakening (<10s)</small></div>
            <div class="btn" data-val="2" onclick="upd('rass','val',-3,this)"><strong>-3 Moderate Sedation</strong><small>Movement to voice (no eye contact)</small></div>
            <div class="btn" data-val="3" onclick="upd('rass','val',-4,this)"><strong>-4 Deep Sedation</strong><small>Movement to physical stimulus</small></div>
            <div class="btn" data-val="3" onclick="upd('rass','val',-5,this)"><strong>-5 Unarousable</strong><small>No response to stimulus</small></div>
        </div>
        <div id="res-rass" class="result-box">RASS: 0</div>
    </div>
</details>

<details id="det-padss">
    <summary>PADSS (Discharge)</summary>
    <div class="content score-high-good">
        <div class="param-group"><span class="label">Vital Signs</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('padss','vs',2,this)"><strong>&le;20% Baseline</strong></div><div class="btn" data-val="1" onclick="upd('padss','vs',1,this)"><strong>20-40% Base</strong></div><div class="btn" data-val="0" onclick="upd('padss','vs',0,this)"><strong>&gt;40% Base</strong></div></div></div>
        <div class="param-group"><span class="label">Ambulation</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('padss','amb',2,this)"><strong>Steady gait</strong></div><div class="btn" data-val="1" onclick="upd('padss','amb',1,this)"><strong>With assist</strong></div><div class="btn" data-val="0" onclick="upd('padss','amb',0,this)"><strong>None/Dizzy</strong></div></div></div>
        <div class="param-group"><span class="label">Nausea/Vomiting</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('padss','nv',2,this)"><strong>Minimal/None</strong></div><div class="btn" data-val="1" onclick="upd('padss','nv',1,this)"><strong>Moderate</strong></div><div class="btn" data-val="0" onclick="upd('padss','nv',0,this)"><strong>Severe</strong></div></div></div>
        <div class="param-group"><span class="label">Pain</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('padss','pain',2,this)"><strong>Minimal</strong></div><div class="btn" data-val="1" onclick="upd('padss','pain',1,this)"><strong>Moderate</strong></div><div class="btn" data-val="0" onclick="upd('padss','pain',0,this)"><strong>Severe</strong></div></div></div>
        <div class="param-group"><span class="label">Surgical Bleeding</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('padss','bld',2,this)"><strong>Minimal</strong></div><div class="btn" data-val="1" onclick="upd('padss','bld',1,this)"><strong>Moderate</strong></div><div class="btn" data-val="0" onclick="upd('padss','bld',0,this)"><strong>Severe</strong></div></div></div>
        <div id="res-padss" class="result-box">PADSS: 10/10 (Dischargeable)</div>
    </div>
</details>

<details id="det-aldrete">
    <summary>Aldrete Score</summary>
    <div class="content score-high-good">
        <div class="param-group"><span class="label">Activity</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('aldrete','act',2,this)"><strong>4 Extremities</strong></div><div class="btn" data-val="1" onclick="upd('aldrete','act',1,this)"><strong>2 Extremities</strong></div><div class="btn" data-val="0" onclick="upd('aldrete','act',0,this)"><strong>None</strong></div></div></div>
        <div class="param-group"><span class="label">Respiration</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('aldrete','resp',2,this)"><strong>Deep/Cough</strong></div><div class="btn" data-val="1" onclick="upd('aldrete','resp',1,this)"><strong>Dyspnea</strong></div><div class="btn" data-val="0" onclick="upd('aldrete','resp',0,this)"><strong>Apnea</strong></div></div></div>
        <div class="param-group"><span class="label">Circulation</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('aldrete','circ',2,this)"><strong>&plusmn;20% BP</strong></div><div class="btn" data-val="1" onclick="upd('aldrete','circ',1,this)"><strong>&plusmn;20-50%</strong></div><div class="btn" data-val="0" onclick="upd('aldrete','circ',0,this)"><strong>&gt;50% BP</strong></div></div></div>
        <div class="param-group"><span class="label">Consciousness</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('aldrete','cns',2,this)"><strong>Fully Awake</strong></div><div class="btn" data-val="1" onclick="upd('aldrete','cns',1,this)"><strong>Arousable</strong></div><div class="btn" data-val="0" onclick="upd('aldrete','cns',0,this)"><strong>Unresponsive</strong></div></div></div>
        <div class="param-group"><span class="label">Oxygenation</span><div class="grid"><div class="btn selected" data-val="2" onclick="upd('aldrete','o2',2,this)"><strong>>92% RA</strong></div><div class="btn" data-val="1" onclick="upd('aldrete','o2',1,this)"><strong>>90% w/ O2</strong></div><div class="btn" data-val="0" onclick="upd('aldrete','o2',0,this)"><strong>&lt;90% w/ O2</strong></div></div></div>
        <div id="res-aldrete" class="result-box">Aldrete: 10/10 (Recovery OK)</div>
    </div>
</details>

<details id="det-bromage">
    <summary>Bromage Score</summary>
    <div class="content">
        <div class="grid" style="grid-template-columns: 1fr;">
            <div class="btn selected" data-val="0" onclick="upd('bromage','val',0,this)"><strong>0 (None)</strong><small>Full movement of hip, knee, ankle</small></div>
            <div class="btn" data-val="1" onclick="upd('bromage','val',1,this)"><strong>1 (Partial)</strong><small>No hip flex. Knee/ankle ok</small></div>
            <div class="btn" data-val="1" onclick="upd('bromage','val',2,this)"><strong>2 (Almost Complete)</strong><small>No hip/knee flex. Ankle ok</small></div>
            <div class="btn" data-val="1" onclick="upd('bromage','val',3,this)"><strong>3 (Complete)</strong><small>No movement at all</small></div>
        </div>
        <div id="res-bromage" class="result-box">Bromage: 0 (Full Motor)</div>
    </div>
</details>

<script>
    // --- Data Stores (Initialized to Healthy/Optimal) ---
    const data = {
        ews_d: { arrest:0, avpu:0, bp:0, hr:0, rr:0, temp:0, sat:0, o2:0, _blue: false },
        ews_p: { arrest:0, beh:0, cv:0, resp:0, _blue: false },
        ews_o: { arrest:0, avpu:0, hr:0, sys:0, dia:0, rr:0, temp:0, sat:0, pain:0, lochia:0, prot:0, _blue: false },
        sofa: { resp:0, coag:0, liv:0, cv:0, cns:0, ren:0 },
        // PADSS & Aldrete optimal score is 2 per category (Total 10)
        padss: { vs:2, amb:2, nv:2, pain:2, bld:2 }, 
        aldrete: { act:2, resp:2, circ:2, cns:2, o2:2 },
        rass: 0,
        bromage: 0
    };

    // --- Core Logic ---
    function upd(sys, param, val, el) {
        // UI Update
        const sibs = el.parentElement.children;
        for(let s of sibs) s.classList.remove('selected');
        el.classList.add('selected');

        // Logic Update
        if(sys === 'rass' || sys === 'bromage') {
            data[sys] = val;
        } else if (sys.startsWith('ews')) {
            // Check for Blue flags (special value 99 or specific param)
            if(param === 'arrest' && val === 1) data[sys]._blue = true;
            else if(val === 99) data[sys]._blue = true;
            else {
                data[sys][param] = val;
                data[sys]._blue = checkBlue(sys);
            }
            if(val !== 99 && param !== 'arrest') data[sys][param] = val;
        } else {
            data[sys][param] = val;
        }

        // Calculation
        calculate(sys);
    }

    function checkBlue(sys) {
        if(data[sys].arrest === 1) return true;
        for(let k in data[sys]) {
            if(data[sys][k] === 99) return true;
        }
        return false;
    }

    function calculate(sys) {
        const box = document.getElementById(`res-${sys}`);
        // Ensure result box is always visible
        box.classList.add('show');
        box.className = 'result-box show'; // Reset colors
        
        let score = 0;
        let txt = "";
        let cls = "res-normal";

        // --- EWS DEWASA ---
        if(sys === 'ews_d') {
            for(let k in data.ews_d) if(k!=='_blue') score += data.ews_d[k];
            if(data.ews_d._blue) { txt = "CODE BLUE"; cls = "res-blue"; }
            else if(score >= 7) { txt = `Score: ${score} (High Risk)`; cls = "res-danger"; } // Standard NEWS2 cutoffs
            else if(score >= 5) { txt = `Score: ${score} (Medium Risk)`; cls = "res-danger"; }
            else if(score >= 1) { txt = `Score: ${score} (Low Risk)`; cls = "res-warn"; }
            else { txt = `Score: ${score}`; cls = "res-normal"; }
        }

        // --- EWS PEDS ---
        else if(sys === 'ews_p') {
            for(let k in data.ews_p) if(k!=='_blue') score += data.ews_p[k];
            if(data.ews_p._blue) { txt = "EMERGENCY"; cls = "res-blue"; }
            else if(score >= 5) { txt = `PEWS: ${score} (High)`; cls = "res-danger"; }
            else if(score >= 3) { txt = `PEWS: ${score} (Med)`; cls = "res-warn"; }
            else { txt = `PEWS: ${score}`; cls = "res-normal"; }
        }

        // --- EWS OBSTETRIC ---
        else if(sys === 'ews_o') {
            let hasRed = false; // score 3 anywhere
            for(let k in data.ews_o) {
                if(k!=='_blue') {
                    score += data.ews_o[k];
                    if(data.ews_o[k] === 3) hasRed = true;
                }
            }
            if(data.ews_o._blue) { txt = "EMERGENCY"; cls = "res-blue"; }
            else if(score >= 5 || hasRed) { txt = `MEWS: ${score} (Red Trigger)`; cls = "res-danger"; }
            else if(score >= 4) { txt = `MEWS: ${score} (Yellow Trigger)`; cls = "res-warn"; }
            else { txt = `MEWS: ${score}`; cls = "res-normal"; }
        }

        // --- SOFA ---
        else if(sys === 'sofa') {
            for(let k in data.sofa) score += data.sofa[k];
            
            // Mortality Logic
            const getMort = (s, type) => {
                // Returns string % based on CSV
                if(type === 'init') {
                    if(s<=1) return "0.0%"; if(s<=3) return "6.4%"; if(s<=5) return "20.2%";
                    if(s<=7) return "21.5%"; if(s<=9) return "33.3%"; if(s<=11) return "50.0%";
                    return "95.2%";
                }
                if(type === 'high') {
                    if(s<=1) return "0.0%"; if(s<=3) return "1.5%"; if(s<=5) return "6.7%";
                    if(s<=7) return "18.2%"; if(s<=9) return "26.3%"; if(s<=11) return "45.8%";
                    if(s<=14) return "80.0%"; return "89.7%";
                }
                if(type === 'mean') {
                    // CSV has floats, we approx integer scores
                    if(s<=1) return "1.2%"; if(s<=2) return "5.4%"; if(s<=3) return "20.0%";
                    if(s<=4) return "36.1%"; if(s<=5) return "73.1%"; return "84.4%";
                }
            };

            txt = `Total SOFA: ${score}`;
            txt += `<table class="mortality-table">
                <tr><td>If Initial Score</td><td>${getMort(score, 'init')} Mort.</td></tr>
                <tr><td>If Mean Score</td><td>${getMort(score, 'mean')} Mort.</td></tr>
                <tr><td>If Highest Score</td><td>${getMort(score, 'high')} Mort.</td></tr>
            </table>`;
            
            if(score > 10) cls = "res-danger";
            else if(score > 5) cls = "res-warn";
        }

        // --- RASS ---
        else if(sys === 'rass') {
            score = data.rass;
            txt = `RASS: ${score > 0 ? '+'+score : score}`;
            if(score >= 2 || score <= -3) cls = "res-danger";
            else if(score !== 0) cls = "res-warn";
        }

        // --- PADSS ---
        else if(sys === 'padss') {
            for(let k in data.padss) score += data.padss[k];
            txt = `PADSS: ${score}/10`;
            if(score >= 9) { txt += " (Dischargeable)"; cls = "res-normal"; }
            else { txt += " (Observe)"; cls = "res-warn"; }
        }

        // --- ALDRETE ---
        else if(sys === 'aldrete') {
            for(let k in data.aldrete) score += data.aldrete[k];
            txt = `Aldrete: ${score}/10`;
            if(score >= 9) { txt += " (Recovery OK)"; cls = "res-normal"; }
            else { txt += " (Observe)"; cls = "res-warn"; }
        }

        // --- BROMAGE ---
        else if(sys === 'bromage') {
            score = data.bromage;
            txt = `Bromage: ${score}`;
            if(score === 0) { txt += " (Full Motor)"; cls = "res-normal"; }
            else { txt += " (Block Present)"; cls = "res-warn"; }
        }

        box.innerHTML = txt;
        box.classList.add(cls);
    }

    // --- RSBI Calculation ---
    function calcRSBI() {
        const rr = parseFloat(document.getElementById('rsbi-rr').value);
        const tv_ml = parseFloat(document.getElementById('rsbi-tv').value);
        const box = document.getElementById('res-rsbi');
        
        if(!rr || !tv_ml) {
            box.innerHTML = "Enter RR and Tidal Volume";
            box.className = "result-box show";
            return;
        }

        const tv_l = tv_ml / 1000;
        const rsbi = (rr / tv_l).toFixed(1);
        
        box.className = "result-box show";
        if(rsbi < 105) {
            box.innerHTML = `RSBI: ${rsbi}<br><small>Favorable for weaning</small>`;
            box.classList.add('res-normal');
        } else {
            box.innerHTML = `RSBI: ${rsbi}<br><small>High risk of failure</small>`;
            box.classList.add('res-danger');
        }
    }

    // Initialize all calculations on load to reflect healthy defaults
    window.onload = function() {
        calculate('ews_d');
        calculate('ews_p');
        calculate('ews_o');
        calculate('sofa');
        calculate('rass');
        calculate('padss');
        calculate('aldrete');
        calculate('bromage');
    };
</script>

</body>
</html>

